<div id="toolbar"></div>

<table class="table"
       data-toolbar="#toolbar"
       data-toggle="table"
       data-search="true"
       data-show-columns="true"
       data-minimum-count-columns="2"
       data-show-export="true"
       >
    <thead>
        <tr>
            <th data-sortable=true>Position</th>
            <th data-sortable=true>Reference</th>
            <th data-sortable=true>Mutated</th>
            <th data-sortable=true
                data-switchable=true>{{ value_type }}</th>
            <th data-sortable=true
                data-switchable=true>Mutation type</th>
            <th data-sortable=true
                data-visible={{ filters.active.is_ptm|lower }}>Impact on PTM</th>
            <th data-sortable=true
                data-visible={{ filters.active.is_ptm|lower }}># PTMs affected</th>
            {% if mutations %}
            {% for metadata_colum in mutations[0].meta[filters.active.sources].keys() %}
                <th data-sortable=true
                    data-switchable=true>{{ metadata_colum }}</th>
            {% endfor %}
            {% endif %}
        </tr>
    </thead>
    <tbody>
		{% for mutation in mutations or '' %}
        {% set metadata=mutation.meta[filters.active.sources] %}
        <tr class="{{ mutation.category }}">
            <td>{{ mutation.coord }}</td>
            <td>{{ mutation.ref }}</td>
            <td>{{ mutation.alt }}</td>
            <td>{{ mutation.value }}</td>
            <td>{{ 'non-PTM' if mutation.category == 'none' else 'PTM' }}</td>
            <td>{{ mutation.category or '' }}</td>
            <td>{{ mutation.sites | length }}</td>
            {% for column in metadata.values() %}
                <td>
                    {% if column is sequence and column is not string %}
                        {% for entry in column %}
                            <div class="sub-cell">
                                {% for key, value in entry.items() %}
                                    {{ key }}: {{ value }}<br>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    {% else %}
                        {{ column }}
                    {% endif %}
                </td>
            {% endfor %}
        </tr>
		{% endfor %}
    </tbody>
</table>
