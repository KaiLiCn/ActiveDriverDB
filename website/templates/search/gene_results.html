{% macro isoform_result(isoform) %}
<div class="isoform">
  <h5>{{ isoform.refseq }}</h5>
  <div class="isoform-data">
      {% if isoform.cds_start and isoform.cds_end %}
      Coding region:
          start {{ isoform.cds_start }}
          end {{ isoform.cds_end }}
          Length: {{ isoform.cds_end - isoform.cds_start }}
      {% endif %}
      {% if isoform.tx_start and isoform.tx_end %}
      Transcription positions:
          start {{ isoform.tx_start }}
          end {{ isoform.tx_end }}
      {% endif %}
  </div>
  <div class="shortcuts">
    <a href="{{ url_for('ProteinView:show', refseq=isoform.refseq) }}">protein</a>
    {# Note: fetching interactors may be slow sometimes, although very useful #}
    {% set interactors = isoform.interactors_count %}
      <a href="{{ url_for('NetworkView:show', refseq=isoform.refseq) }}" class="{{ 'inactive' if not interactors }}">
      network
      {% if interactors %}
        ({{ interactors }})
      {% endif %}
    </a>
  </div>
</div>
{% endmacro %}

{% macro gene_results(gene) %}
  <div class="result">
    <h4><a href="{{ url_for('ProteinView:show', refseq=gene.preferred_isoform.refseq) }}">{{ gene.name }}</a></h4>
    <div class="chrom">{{ gene.chrom }}</div>
    <div class="strand">{{ '+' if gene.strand else '-' }}</div>
    {{ isoform_result(gene.preferred_isoform) }}
    {% if gene.alternative_isoforms %}
        {% set alt_iso_cnt = gene.alternative_isoforms | length %}
        <input type="button" class="hidden btn btn-default show-alt"
         value="Show {{ alt_iso_cnt }} isoform{{ 's' if alt_iso_cnt > 1 }} more">
        <div class="alt-isoforms">
        {% for isoform in gene.alternative_isoforms %}
            {{ isoform_result(isoform) }}
        {% endfor %}
        </div>
    {% endif %}
  </div>
{% endmacro %}

{% if gene %}
  {{ gene_results(gene) }}
{% endif %}
