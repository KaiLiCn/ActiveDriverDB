{% extends "base.html" %}

{% block title %}
    {{ protein.gene.name }} - {{ protein.refseq }} - network view - {{ super() }}
{% endblock %}

{% block head %}
  {{ super() }}

  {% assets "css_network" %}
    <link rel="stylesheet" href="{{ ASSET_URL }}">
  {% endassets %}


  {# jQuery #}
  <script src="/static/thirdparty/jquery-1.12.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

  {# D3.js #}
  {# <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script> #}
  <script src="/static/thirdparty/d3.v3.min.js" charset="utf-8"></script>

  {# Bootstrap multiselect #}
  <script type="text/javascript" src="/static/thirdparty/bootstrap-multiselect/bootstrap-multiselect.js"></script>
  <link rel="stylesheet" href="/static/thirdparty/bootstrap-multiselect/bootstrap-multiselect.css" type="text/css"/>
{% endblock %}


{% block content %}

    <h3>{{ protein.gene.name }} - {{ protein.refseq }}</h3>

    <ol class="breadcrumb">
        <li><a href="/">Home</a></li>
        <li><a href="/network">Network</a></li>
        <li><a href="{{ url_for('GeneView:show', gene_name=protein.gene.name) }}">{{ protein.gene.name }}</a></li>
        <li class="active">{{ protein.refseq }}</li>
    </ol>

    <form method="get" id="widget-form">
        {% with filter_widgets=filter_widgets %}
            {% include 'forms/filters.html' %}
        {% endwith %}

        {% with option_widgets=option_widgets %}
            {% include 'forms/options.html' %}
        {% endwith %}

        <input type="hidden" name="fallback" value="True">
    </form>

    <div class="panel panel-default network">
        <div class="panel-heading">
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-default zoom-in" title="Zoom in">
                  <span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span> Zoom in
              </button>
              <button type="button" class="btn btn-default zoom-fit" title="Fit to the window">
                  <span class="glyphicon glyphicon-screenshot" aria-hidden="true"></span> Fit to the window
              </button>
              <button type="button" class="btn btn-default zoom-out" title="Zoom out">
                  <span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span> Zoom out
              </button>
            </div>
        </div>
        <div id="network_plot" class="panel-body"></div>
    </div>

{% endblock %}


{% block footer_js %}
    {% assets "js_network_view" %}
	<script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
    <script type="text/javascript">

    Network.init({
        show_sites: {{ filters.get_value('JavaScript.show_sites') | lower }},
        clone_by_site: {{ filters.get_value('JavaScript.clone_by_site') | lower }},
        element: document.getElementById('network_plot'),
        data: {{ data | safe }},
        minimal_radius: 15,
        ratio: 0.5, /* remember to keep update with style of network */
        nodeURL: function(node){
            return '{{ url_for('ProteinView:show', refseq='') }}' + node.protein.refseq
        }
    })

    $('.zoom-in').on('click', Network.zoom_in)
    $('.zoom-out').on('click', Network.zoom_out)
    $('.zoom-fit').on('click', Network.zoom_fit)

    </script>
{% endblock %}
